<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
    <title>Mario: Adventures Block</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bangers&display=swap" rel="stylesheet">

    <style>
        * { -webkit-tap-highlight-color: transparent; touch-action: manipulation; user-select: none; -webkit-user-select: none; }
        body { margin: 0; padding: 0; background-color: #5c94fc; overflow: hidden; display: flex; flex-direction: column; align-items: center; touch-action: none; font-family: 'Bangers', cursive; transition: background-color 1s; }
        canvas { display: block; }
        .screen { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 20; }
        #menuScreen { background: linear-gradient(#5c94fc, #85b4ff); z-index: 30; }
        #levelSelectScreen { display: none; background: linear-gradient(#444, #222); z-index: 25; }
        #loadingScreen { display: none; background: #000; z-index: 35; }
        #victoryScreen, #pauseScreen { display: none; background: rgba(0,0,0,0.9); z-index: 40; }
        h1 { color: #ff3333; font-size: 50px; text-align: center; line-height: 1.1; margin-bottom: 20px; text-shadow: 2px 2px 0px #fff, 4px 4px 0px #000; letter-spacing: 2px; }
        .victory-title { color: #22b14c; font-size: 45px; }
        .pause-title { color: #FFD700; font-size: 50px; }
        .level-title { color: #00BFFF; font-size: 45px; }
        .loading-text { color: #fff; font-size: 40px; letter-spacing: 3px; animation: loadingPulse 1.5s infinite alternate; }
        @keyframes loadingPulse { from { opacity: 0.6; transform: scale(0.95); } to { opacity: 1; transform: scale(1.05); } }
        button { font-family: 'Bangers', cursive; color: white; border: 3px solid #fff; padding: 12px 25px; font-size: 24px; border-radius: 10px; cursor: pointer; outline: none; margin: 8px; text-shadow: 2px 2px 0 #000; width: 80%; max-width: 300px; }
        .lvl-btn { background-color: #ff8c00; display: flex; justify-content: space-between; align-items: center; padding: 15px 30px; }
        .lvl-btn.locked { background-color: #555; color: #888; border-color: #888; pointer-events: none; }
        #btnJogar { background-color: #22b14c; font-size: 35px; padding: 15px 60px; box-shadow: 0 6px 0px #005500; animation: btnPulse 1.5s infinite alternate; width: auto; }
        @keyframes btnPulse { from { transform: scale(1); } to { transform: scale(1.05); } }
        #btnResume { background-color: #007bff; box-shadow: 0 5px 0px #004499; }
        #btnMenu, #btnQuit, #btnBackMenu { background-color: #dc3545; box-shadow: 0 5px 0px #992233; }
        button:active { transform: translateY(4px); box-shadow: 0 2px 0px #000; }
        .credits { color: #FFD700; font-size: 24px; text-shadow: 2px 2px 0px #000; letter-spacing: 1px; margin-top: 20px; }
        #controles { position: absolute; bottom: 30px; width: 100%; display: none; justify-content: space-between; padding: 0 20px; box-sizing: border-box; pointer-events: none; z-index: 10; }
        .controles-esquerda { display: flex; gap: 15px; }
        .btn { pointer-events: auto; width: 80px; height: 80px; background-color: rgba(255,255,255,0.2); border-radius: 50%; border: 4px solid white; font-size: 20px; display: flex; align-items: center; justify-content: center; color: #fff; text-shadow: 2px 2px 4px black; font-family: 'Bangers', cursive; user-select: none; box-shadow: 0 0 15px rgba(0,0,0,0.5); }
        .btn-jump { width: 100px; height: 100px; font-size: 22px; }
        .btn:active, .btn.pressed { background-color: rgba(255,215,0,0.5); color: #000; transform: scale(0.95); }
        #btnPause { position: absolute; top: 20px; right: 20px; width: 50px; height: 50px; background-color: rgba(255,255,255,0.5); border: 3px solid white; border-radius: 50%; color: #333; font-weight: bold; font-size: 20px; display: none; align-items: center; justify-content: center; cursor: pointer; z-index: 15; font-family: Arial, sans-serif; }
    </style>
</head>
<body>

    <div id="menuScreen" class="screen">
        <h1>MARIO:<br>ADVENTURE</h1>
        <button id="btnJogar">JOGAR</button>
        <div class="credits">By: Pyettro007</div>
    </div>

    <div id="levelSelectScreen" class="screen">
        <h1 class="level-title">SELECIONAR N√çVEL</h1>
        <button id="btnLvl1" class="lvl-btn">N√çVEL 1 <span>‚≠ê</span></button>
        <button id="btnLvl2" class="lvl-btn locked">N√çVEL 2 <span>üîí</span></button>
        <button id="btnBackMenu">VOLTAR</button>
    </div>

    <div id="loadingScreen" class="screen"><div class="loading-text">CARREGANDO...</div></div>
    <div id="victoryScreen" class="screen"><h1 class="victory-title">PARAB√âNS!<br>JOGO ZERADO!</h1><button id="btnMenu">VOLTAR AO MENU</button></div>
    <div id="pauseScreen" class="screen"><h1 class="pause-title">JOGO PAUSADO</h1><button id="btnResume">CONTINUAR</button><button id="btnQuit">SAIR DA FASE</button></div>

    <div id="btnPause">||</div>
    <canvas id="gameCanvas"></canvas>

    <div id="controles">
        <div class="controles-esquerda">
            <div class="btn" id="btnLeft">‚óÄ</div>
            <div class="btn" id="btnRight">‚ñ∂</div>
        </div>
        <div class="controles-direita">
            <div class="btn btn-jump" id="btnJump">PULAR</div>
        </div>
    </div>

<script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    
    let gameRunning = false;
    let currentLevel = 1;
    let unlockedLevels = 1;
    let finalFlagX = 18600;
    let cameraX = 0;
    let direction = 1;
    let currentSpawnX = 50;
    let isDying = false;

    const player = { x: 50, y: 200, width: 40, height: 40, hitWidth: 20, dx: 0, dy: 0, jumpPower: -13, grounded: false, speed: 5, acceleration: 0.8, friction: 0.85 };
    const gravity = 0.6;
    const maxFallSpeed = 12;

    let platforms = [], enemies = [], decorations = [], clouds = [];
    const keys = { left: false, right: false };

    const AudioContext = window.AudioContext || window.webkitAudioContext;
    const audioCtx = new AudioContext();

    function tocarSom(tipo) {
        if (audioCtx.state === 'suspended') audioCtx.resume();
        const o = audioCtx.createOscillator(), g = audioCtx.createGain();
        if (tipo === 'pulo') { o.type = 'square'; o.frequency.setValueAtTime(180, audioCtx.currentTime); o.frequency.linearRampToValueAtTime(500, audioCtx.currentTime + 0.1); g.gain.setValueAtTime(0.2, audioCtx.currentTime); g.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.15); }
        else if (tipo === 'morte_inimigo') { o.type = 'sawtooth'; o.frequency.setValueAtTime(100, audioCtx.currentTime); g.gain.setValueAtTime(0.2, audioCtx.currentTime); g.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1); }
        else if (tipo === 'morte_mario') { o.type = 'sawtooth'; o.frequency.setValueAtTime(300, audioCtx.currentTime); o.frequency.linearRampToValueAtTime(50, audioCtx.currentTime + 0.5); g.gain.setValueAtTime(0.3, audioCtx.currentTime); g.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.5); }
        else if (tipo === 'checkpoint') { o.type = 'sine'; o.frequency.setValueAtTime(400, audioCtx.currentTime); o.frequency.linearRampToValueAtTime(800, audioCtx.currentTime + 0.2); g.gain.setValueAtTime(0.2, audioCtx.currentTime); g.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3); }
        else if (tipo === 'level_complete') { o.type = 'triangle'; o.frequency.setValueAtTime(300, audioCtx.currentTime); o.frequency.linearRampToValueAtTime(600, audioCtx.currentTime + 0.5); g.gain.setValueAtTime(0.3, audioCtx.currentTime); g.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 1.0); }
        o.connect(g); g.connect(audioCtx.destination); o.start(); o.stop(audioCtx.currentTime + 1.0);
    }

    // === TELAS ===
    document.getElementById("btnJogar").onclick = () => { document.getElementById("menuScreen").style.display = "none"; document.getElementById("levelSelectScreen").style.display = "flex"; atualizarBotoesNivel(); };
    document.getElementById("btnBackMenu").onclick = () => { document.getElementById("levelSelectScreen").style.display = "none"; document.getElementById("menuScreen").style.display = "flex"; };
    function atualizarBotoesNivel() { if (unlockedLevels >= 2) { document.getElementById("btnLvl2").classList.remove("locked"); document.getElementById("btnLvl2").innerHTML = "N√çVEL 2 <span>‚≠ê</span>"; } }

    function carregarNivel(nivel) {
        currentLevel = nivel;
        document.getElementById("levelSelectScreen").style.display = "none";
        document.getElementById("loadingScreen").style.display = "flex";
        currentSpawnX = 50; player.dx = player.dy = 0; isDying = false; keys.left = keys.right = false;
        resetGame();
        setTimeout(() => {
            document.getElementById("loadingScreen").style.display = "none";
            document.getElementById("controles").style.display = "flex";
            document.getElementById("btnPause").style.display = "flex";
            gameRunning = true;
            update();
        }, 2000);
    }
    document.getElementById("btnLvl1").onclick = () => carregarNivel(1);
    document.getElementById("btnLvl2").onclick = () => { if (unlockedLevels >= 2) carregarNivel(2); };

    document.getElementById("btnPause").onclick = () => { if (!gameRunning || isDying) return; gameRunning = false; keys.left = keys.right = false; document.getElementById("pauseScreen").style.display = "flex"; document.getElementById("controles").style.display = "none"; document.getElementById("btnPause").style.display = "none"; };
    document.getElementById("btnResume").onclick = () => { document.getElementById("pauseScreen").style.display = "none"; document.getElementById("controles").style.display = "flex"; document.getElementById("btnPause").style.display = "flex"; gameRunning = true; update(); };
    document.getElementById("btnQuit").onclick = () => { gameRunning = false; document.getElementById("pauseScreen").style.display = "none"; document.getElementById("controles").style.display = "none"; document.getElementById("btnPause").style.display = "none"; document.getElementById("levelSelectScreen").style.display = "flex"; document.body.style.backgroundColor = "#5c94fc"; atualizarBotoesNivel(); };
    document.getElementById("btnMenu").onclick = () => { document.getElementById("victoryScreen").style.display = "none"; document.getElementById("menuScreen").style.display = "flex"; document.body.style.backgroundColor = "#5c94fc"; };

    // === FASES ===
    function iniciarFase() {
        platforms = []; enemies = []; decorations = []; clouds = [];
        const gY = canvas.height - 40;
        const addPlat = (x,y,w,h,type='grass') => { platforms.push({x,y,w,h,type,active:false}); if(type==='grass') gerarDecoracao({x,y,w}); };
        const addEnemy = (x,y,range) => enemies.push({x, y:y-40, width:40, height:40, startX:x, endX:x+range, speed:2, dir:1, dead:false });

        if (currentLevel === 1) {
            document.body.style.backgroundColor = "#5c94fc";
            for(let i=0;i<30;i++) clouds.push({x:i*800+Math.random()*400, y:Math.random()*200+50, size:Math.random()*0.5+0.8});

            addPlat(0,gY,1500,40); 
            addPlat(1650,gY,1200,40);
            addPlat(2000,gY-100,200,20); 
            addPlat(2400,gY-150,200,20);
            addPlat(3000,gY,2000,40);
            addEnemy(3500,gY,300);
            addEnemy(4200,gY,300);
            addPlat(5200,gY,3000,40);
            addPlat(5600,gY-60,200,20);
            addPlat(6000,gY-120,200,20);
            addEnemy(6500,gY,500);
            addPlat(8400,gY,1000,40);
            addPlat(9400,gY-150,20,150,'checkpoint');
            addPlat(9350,gY,6950,40); // ch√£o longo depois do checkpoint

            // === +13 GOOMBAS ALEAT√ìRIOS DEPOIS DO CHECKPOINT ===
            for(let i = 0; i < 13; i++) {
                let posX = 9800 + Math.random() * 6000; // entre 9800 e 15800 (√°rea segura do ch√£o longo)
                let range = 200 + Math.random() * 400; // caminho de 200 a 600px
                addEnemy(posX, gY, range);
            }

            // 3 buracos finais
            addPlat(16300,gY,800,40);
            addPlat(17200,gY,700,40);
            addPlat(18000,gY,600,40);
            addPlat(finalFlagX,gY-150,20,150,'flag');
        } 
        else if (currentLevel === 2) {
            document.body.style.backgroundColor = "#FF8C00";
            addPlat(0,gY,800,40); addPlat(900,gY-80,100,20); addPlat(1100,gY-160,100,20); addPlat(1300,gY-240,400,40);
            addPlat(1800,gY-120,100,20); addPlat(2000,gY,1000,40); addEnemy(2300,gY,400);
            addPlat(3100,gY,200,40); addPlat(3350,gY-40,200,40); addPlat(3600,gY-80,200,40); addPlat(3850,gY-40,200,40);
            addPlat(4200,gY,2000,40); addEnemy(4600,gY,300); addEnemy(5000,gY,300);
            addPlat(6400,gY-50,150,20); addPlat(6650,gY-100,150,20); addPlat(6900,gY-150,150,20);
            addPlat(7100,gY-150,600,40); addPlat(7300,gY-300,20,150,'checkpoint');
            addPlat(7800,gY,3000,40); addEnemy(8500,gY,500); addEnemy(9500,gY,500);
            addPlat(11000,gY-100,200,20); addPlat(11300,gY-100,200,20); addPlat(11600,gY-100,200,20);
            addPlat(11000,gY,10000,40); addEnemy(13000,gY,200); addEnemy(13500,gY,200); addEnemy(14000,gY,200);
            addPlat(15500,gY-60,100,20); addPlat(15800,gY-120,100,20);
            addPlat(finalFlagX,gY-150,20,150,'flag');
        }
    }

    function gerarDecoracao(plat) {
        if (plat.type !== 'grass') return;
        for (let i = 0; i < plat.w/100; i++) if (Math.random() > 0.4) {
            let tipo = Math.random() > 0.5 ? 'tree' : 'bush';
            let decX = plat.x + i*100 + Math.random()*50;
            if (decX > plat.x + 10 && decX < plat.x + plat.w - 40) decorations.push({x:decX, y:plat.y, type:tipo});
        }
    }

    // === CONTROLES E LOOP (100% EST√ÅVEL) ===
    const btnLeft = document.getElementById("btnLeft"), btnRight = document.getElementById("btnRight"), btnJump = document.getElementById("btnJump");
    ['touchstart','mousedown'].forEach(e=> { btnLeft.addEventListener(e, ev=> {ev.preventDefault(); keys.left=true; btnLeft.classList.add('pressed');});
        btnRight.addEventListener(e, ev=> {ev.preventDefault(); keys.right=true; btnRight.classList.add('pressed');});
        btnJump.addEventListener(e, ev=> {ev.preventDefault(); if(player.grounded){player.dy=player.jumpPower; player.grounded=false; tocarSom('pulo');}});
    });
    ['touchend','mouseup','mouseleave'].forEach(e=> { btnLeft.addEventListener(e,()=>{keys.left=false; btnLeft.classList.remove('pressed');});
        btnRight.addEventListener(e,()=>{keys.right=false; btnRight.classList.remove('pressed');});
    });

    window.onkeydown = e => { if(!gameRunning) return; if(['ArrowLeft','KeyA'].includes(e.code)) keys.left=true; if(['ArrowRight','KeyD'].includes(e.code)) keys.right=true; if(['Space','ArrowUp','KeyW'].includes(e.code)) {if(player.grounded){player.dy=player.jumpPower; player.grounded=false; tocarSom('pulo');}} };
    window.onkeyup = e => { if(['ArrowLeft','KeyA'].includes(e.code)) keys.left=false; if(['ArrowRight','KeyD'].includes(e.code)) keys.right=false; };

    function update() {
        if (!gameRunning) return;
        if (isDying) { player.dy += gravity; player.y += player.dy; draw(); requestAnimationFrame(update); return; }

        let touchedFlag = false;
        platforms.forEach(p => {
            if (p.type === 'flag' && checkOverlap(player, p)) touchedFlag = true;
            if (p.type === 'checkpoint' && checkOverlap(player, p) && currentSpawnX !== p.x) { currentSpawnX = p.x; p.active = true; tocarSom('checkpoint'); }
        });
        if (touchedFlag) { levelComplete(); }

        player.dy += gravity; if (player.dy > maxFallSpeed) player.dy = maxFallSpeed;
        player.y += player.dy; player.grounded = false;

        platforms.forEach(p => {
            if (checkOverlap(player, p) && p.type !== 'flag' && p.type !== 'checkpoint') {
                if (player.dy > 0) { player.y = p.y - player.height; player.grounded = true; player.dy = 0; }
                else if (player.dy < 0) { player.y = p.y + p.h; player.dy = 0; }
            }
        });

        if (keys.left) { player.dx -= player.acceleration; direction = -1; }
        if (keys.right) { player.dx += player.acceleration; direction = 1; }
        player.dx = Math.max(-player.speed, Math.min(player.speed, player.dx));
        if (!keys.left && !keys.right) { player.dx *= player.friction; if (Math.abs(player.dx) < 0.1) player.dx = 0; }
        player.x += player.dx;

        platforms.forEach(p => {
            if (checkOverlap(player, p) && p.type !== 'flag' && p.type !== 'checkpoint') {
                const offset = (player.width - player.hitWidth)/2;
                if (player.dx > 0) player.x = p.x - player.width + offset;
                else player.x = p.x + p.w - offset;
                player.dx = 0;
            }
        });

        enemies.forEach(e => {
            if (e.dead) return;
            if (Math.abs(e.x - player.x) < canvas.width * 1.5) { e.x += e.speed * e.dir; if (e.x > e.endX || e.x < e.startX) e.dir *= -1; }
            if (checkRectOverlap({x:player.x+(player.width-player.hitWidth)/2, y:player.y, width:player.hitWidth, height:40}, e)) {
                if (player.dy > 0 && player.y + player.height < e.y + e.height - 10) { e.dead = true; player.dy = -7; tocarSom('morte_inimigo'); }
                else morte();
            }
        });

        if (player.x < 0) player.x = 0;
        if (player.y > canvas.height + 100) morte();

        let target = player.x - canvas.width/3;
        target = Math.max(0, Math.min(finalFlagX - canvas.width + 200, target));
        cameraX += (target - cameraX) * 0.1;

        draw();
        requestAnimationFrame(update);
    }

    function levelComplete() {
        gameRunning = false;
        tocarSom('level_complete');
        document.getElementById("controles").style.display = "none";
        document.getElementById("btnPause").style.display = "none";
        if (currentLevel === 1) {
            unlockedLevels = 2;
            setTimeout(() => {
                alert("N√çVEL 1 COMPLETADO! N√≠vel 2 Desbloqueado!");
                document.getElementById("levelSelectScreen").style.display = "flex";
                document.body.style.backgroundColor = "#5c94fc";
                atualizarBotoesNivel();
            }, 1000);
        } else {
            document.getElementById("victoryScreen").style.display = "flex";
        }
    }

    function morte() { if (isDying) return; isDying = true; tocarSom('morte_mario'); player.dx = 0; player.dy = -5; setTimeout(resetGame, 1000); }
    function resetGame() { player.x = currentSpawnX; player.y = currentSpawnX > 50 ? canvas.height - 500 : 200; if (player.y < 50) player.y = 50; player.dx = player.dy = 0; isDying = false; cameraX = currentSpawnX > 100 ? currentSpawnX - 100 : 0; iniciarFase(); }

    function checkOverlap(a,b) { const ax = a.x + (a.width-a.hitWidth)/2; return ax < b.x + b.w && ax + a.hitWidth > b.x && a.y < b.y + b.h && a.y + a.height > b.y; }
    function checkRectOverlap(r1,r2) { return r1.x < r2.x + r2.width && r1.x + r1.width > r2.x && r1.y < r2.y + r2.height && r1.y + r1.height > r2.y; }

    // === DESENHO ===
    const patternCanvas = document.createElement('canvas'); patternCanvas.width=32; patternCanvas.height=32;
    const pCtx = patternCanvas.getContext('2d'); pCtx.fillStyle="#8B4513"; pCtx.fillRect(0,0,32,32); pCtx.fillStyle="#5e2f0d"; pCtx.fillRect(5,5,4,4); pCtx.fillRect(20,18,5,5);
    const dirtPattern = ctx.createPattern(patternCanvas,'repeat');

    function desenharNuvem(x,y,s){ctx.fillStyle="rgba(255,255,255,0.8)";ctx.beginPath();ctx.arc(x,y,30*s,0,Math.PI*2);ctx.arc(x+25*s,y-10*s,35*s,0,Math.PI*2);ctx.arc(x+50*s,y,30*s,0,Math.PI*2);ctx.fill();}
    function desenharDecoracao(x,y,t){if(t==='tree'){ctx.fillStyle="#8B4513";ctx.fillRect(x+10,y-40,10,40);ctx.fillStyle="#228B22";ctx.beginPath();ctx.arc(x+15,y-45,20,0,Math.PI*2);ctx.arc(x,y-35,15,0,Math.PI*2);ctx.arc(x+30,y-35,15,0,Math.PI*2);ctx.fill();}else{ctx.fillStyle="#32CD32";ctx.beginPath();ctx.arc(x,y-10,15,0,Math.PI*2);ctx.arc(x+20,y-15,18,0,Math.PI*2);ctx.arc(x+40,y-10,15,0,Math.PI*2);ctx.fill();}}
    function desenharMario(x,y,w,h,dir,dx,g){ctx.fillStyle="#E70000";ctx.fillRect(x,y,w,12);if(dir===1)ctx.fillRect(x+10,y+8,w-10,4);else ctx.fillRect(x,y+8,w-10,4);ctx.fillStyle="#FFCC99";ctx.fillRect(x+4,y+12,w-8,12);ctx.fillStyle="#4a3000";if(dir===1)ctx.fillRect(x+4,y+15,6,8);else ctx.fillRect(x+w-10,y+15,6,8);ctx.fillStyle="black";if(dir===1)ctx.fillRect(x+w-15,y+18,10,4);else ctx.fillRect(x+5,y+18,10,4);ctx.fillStyle="#0000EA";ctx.fillRect(x+4,y+24,w-8,8);ctx.fillStyle="yellow";ctx.fillRect(x+8,y+26,4,4);ctx.fillRect(x+w-12,y+26,4,4);let o=g?(Math.abs(dx)>0.5?Math.sin(Date.now()/60)*8:0):6;ctx.fillStyle="#0000EA";let lx=x+8-o;if(lx<x)lx=x;ctx.fillRect(lx,y+32,8,8);let rx=x+w-16+o;if(rx>x+w-8)rx=x+w-8;ctx.fillRect(rx,y+32,8,8);ctx.fillStyle="#5c3317";ctx.fillRect(lx-2,y+36,12,4);ctx.fillRect(rx-2,y+36,12,4);}
    function desenharGoomba(x,y,w,h){ctx.fillStyle="#8B4513";ctx.beginPath();ctx.moveTo(x,y+h-10);ctx.lineTo(x+5,y+10);ctx.quadraticCurveTo(x+w/2,y,x+w-5,y+10);ctx.lineTo(x+w,y+h-10);ctx.fill();ctx.fillStyle="#CD853F";ctx.fillRect(x+10,y+h-15,w-20,10);ctx.fillStyle="black";ctx.beginPath();ctx.ellipse(x+10,y+h-2,8,5,0,0,Math.PI*2);ctx.ellipse(x+w-10,y+h-2,8,5,0,0,Math.PI*2);ctx.fill();ctx.fillStyle="white";ctx.fillRect(x+8,y+15,10,12);ctx.fillRect(x+w-18,y+15,10,12);ctx.fillStyle="black";ctx.fillRect(x+12,y+18,4,6);ctx.fillRect(x+w-16,y+18,4,6);ctx.strokeStyle="black";ctx.lineWidth=3;ctx.beginPath();ctx.moveTo(x+6,y+12);ctx.lineTo(x+18,y+18);ctx.moveTo(x+w-6,y+12);ctx.lineTo(x+w-18,y+18);ctx.stroke();}

    function draw() {
        ctx.clearRect(0,0,canvas.width,canvas.height);
        clouds.forEach(c=>{if(c.x-cameraX+100>0&&c.x-cameraX<canvas.width)desenharNuvem(c.x-cameraX,c.y,c.size);});
        decorations.forEach(d=>{if(d.x-cameraX+50>0&&d.x-cameraX<canvas.width)desenharDecoracao(d.x-cameraX,d.y,d.type);});
        if(!isDying||Math.floor(Date.now()/100)%2===0) desenharMario(player.x-cameraX,player.y,player.width,player.height,direction,player.dx,player.grounded);
        platforms.forEach(p=>{if(p.x-cameraX+p.w>0&&p.x-cameraX<canvas.width){
            if(p.type==='flag'){ctx.fillStyle="#555";ctx.fillRect(p.x-cameraX+5,p.y,10,p.h);ctx.fillStyle="#FFD700";ctx.beginPath();ctx.moveTo(p.x-cameraX+15,p.y);ctx.lineTo(p.x-cameraX+65,p.y+25);ctx.lineTo(p.x-cameraX+15,p.y+50);ctx.fill();ctx.fillStyle="#222";ctx.beginPath();ctx.arc(p.x-cameraX+10,p.y,8,0,Math.PI*2);ctx.fill();}
            else if(p.type==='checkpoint'){ctx.fillStyle="#555";ctx.fillRect(p.x-cameraX+5,p.y,10,p.h);ctx.fillStyle=p.x===currentSpawnX?"#00FF00":"#0055FF";ctx.beginPath();ctx.moveTo(p.x-cameraX+15,p.y);ctx.lineTo(p.x-cameraX+65,p.y+25);ctx.lineTo(p.x-cameraX+15,p.y+50);ctx.fill();ctx.fillStyle="white";ctx.font="16px Arial";ctx.fillText("SAVE",p.x-cameraX+18,p.y+30);ctx.fillStyle="#222";ctx.beginPath();ctx.arc(p.x-cameraX+10,p.y,8,0,Math.PI*2);ctx.fill();}
            else{ctx.save();ctx.translate(-cameraX,0);ctx.fillStyle=dirtPattern;ctx.fillRect(p.x,p.y,p.w,p.h);ctx.restore();ctx.fillStyle="#22b14c";ctx.fillRect(p.x-cameraX,p.y,p.w,10);ctx.strokeStyle="#3e2723";ctx.strokeRect(p.x-cameraX,p.y,p.w,p.h);}
        }});
        enemies.forEach(e=>{if(!e.dead&&e.x-cameraX+e.width>0&&e.x-cameraX<canvas.width)desenharGoomba(e.x-cameraX,e.y,e.width,e.height);});
        const barW=canvas.width*0.6, barH=20, barX=(canvas.width-barW)/2, barY=15;
        ctx.fillStyle="rgba(0,0,0,0.5)";ctx.fillRect(barX,barY,barW,barH);ctx.strokeStyle="white";ctx.lineWidth=2;ctx.strokeRect(barX,barY,barW,barH);
        ctx.fillStyle="white";ctx.font="20px Bangers";ctx.fillText("N√çVEL "+currentLevel,20,32);
        let pct=Math.max(0,Math.min(1,player.x/finalFlagX)); ctx.fillStyle="#00FF00";ctx.fillRect(barX,barY,barW*pct,barH);
    }

    window.onresize = () => { canvas.width = innerWidth; canvas.height = innerHeight; };
</script>
</body>
</html>